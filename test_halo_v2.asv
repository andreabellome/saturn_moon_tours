
clear all; close all; clc; format long g;
addpath(genpath([pwd '/AUTOMATE']));

%% 

idcentral = 1; % --> Sun
idPlanet  = 3;  % --> Earth(+Moon)

strucNorm = wrapNormCR3BP(idcentral, idPlanet);
mu        = strucNorm.normMu;
normDist  = strucNorm.normDist;

%%

lpoint      = 'L2';
Az          = 10e3; % --> this must be in km!!

% --> generate Halo orbit
[ sv0, orb_period, Jc, tt, yy ] = wrap_halo_orbit_generator( Az, lpoint, strucNorm );

close all; clc;
figure( 'Color', [1 1 1] );
xlabel( 'x [km]' ); ylabel( 'y [km]' ); zlabel( 'z [km]' );
hold on; grid on;
plot3( yy(:,1).*normDist, yy(:,2).*normDist, yy(:,3).*normDist, 'LineWidth', 2 );
view( [-2 18] );

%%

close all; clc;

lpoint   = 'L2';
Az_south = [ -10e3:-50e3:-900e3 ];
Az_north = [ 10e3:50e3:900e3 ];

Az_vect = [ Az_south ];

colors = cool(4);

% --> generate the solution
[ halo_orbits_l1, ~ ]   = wrap_halo_family( Az_vect, 'L1', strucNorm, 0, colors(1:2,:) );
[ halo_orbits_l2, fig ] = wrap_halo_family( Az_vect, 'L2', strucNorm, 1, colors(3:4,:) );

hold on;
plot3( strucNorm.x2.*normDist, 0, 0, 'o', 'MarkerEdgeColor', 'k', ...
    'MarkerFaceColor', 'blue', 'MarkerSize', 8, ...
    'DisplayName', 'Secondary body' )

hold on;
plot3( strucNorm.LagrangePoints(1).*normDist, 0, 0, 'o', 'MarkerEdgeColor', 'k', ...
    'MarkerFaceColor', 'red', 'MarkerSize', 8, ...
    'DisplayName', 'L1' )

plot3( strucNorm.LagrangePoints(2).*normDist, 0, 0, 'o', 'MarkerEdgeColor', 'k', ...
    'MarkerFaceColor', 'cyan', 'MarkerSize', 8, ...
    'DisplayName', 'L2' )

%%

close all; clc;

ind_orb = 1;

Az_vect = 550e3;
epsilon = 0.00001;

[ halo_orbits ]   = wrap_halo_family( Az_vect, 'L2', strucNorm, 0, colors(1:2,:) );

sv0            = halo_orbits(ind_orb).sv0;
orbital_period = halo_orbits(ind_orb).orb_period;

% --> generate manifolds for the given orbit
[ manifolds, fig ] = generate_manifolds( sv0, orbital_period, strucNorm, 100, 1e-5, 'stable' );


